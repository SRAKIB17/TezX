Here’s a professional, step-by-step guide to setting up your `TezX` application with Bun, using the provided code that includes `bunAdapter` instead of `Bun.serve`. I’ll assume `./src/index` is a custom module where `TezX` and its utilities (including `bunAdapter`) are defined. I’ll adapt the code, keep the `/products/test` route as per your latest input, and provide a polished setup process.

---

### **TezX Configuration with Bun (Using bunAdapter)**

This guide demonstrates how to create a RESTful API for managing products using `TezX` with Bun, leveraging a custom `bunAdapter` for server setup.

---

#### **Final Code**

```typescript
// Import TezX modules from a custom source
import { bunAdapter, loadEnv, logger, Router, TezX } from "./src/index";

// Load environment variables (e.g., from a .env file)
const env = loadEnv();

// Initialize the TezX application with configuration
const app = new TezX({
  logger: logger, // Built-in logger for request/response logging
  env: env, // Environment variables for configuration
  allowDuplicateMw: true, // Allows duplicate middleware registration
});

// **Product Routes**

// Define a standalone route outside the router
app.get("/products/test", (ctx) => {
  return ctx.text("from outside"); // Simple text response
});

// Initialize a new Router instance for product-related routes
const productRouter = new Router({});

// Group product routes with shared middleware
productRouter.group("", (group) => {
  // Middleware applied to all routes in this group
  group.use((ctx, next) => {
    console.log("inside router"); // Log for debugging
    return next(); // Proceed to next middleware/handler
  });

  // GET /products - Returns an empty JSON object
  group.get("/products", async (ctx) => {
    return ctx.json({});
  });
});

// GET /products/:id - Fetch product by ID
productRouter.get("/products/:id", async (ctx) => {
  return ctx.json({ message: `Product ID: ${ctx.req.params.id}` });
});

// POST /products - Create a new product
productRouter.post("/products", async (ctx) => {
  const productData = await ctx.req.json(); // Parse request body
  return ctx.json({ message: "Product Created", data: productData });
});

// PUT /products/:id - Update a product by ID
productRouter.put("/products/:id", async (ctx) => {
  return ctx.json({ message: `Product ID ${ctx.req.params.id} Updated` });
});

// DELETE /products/:id - Delete a product by ID
productRouter.delete("/products/:id", async (ctx) => {
  return ctx.json({ message: `Product ID ${ctx.req.params.id} Deleted` });
});

// Mount the productRouter at the root path "/"
app.use("/", productRouter);

// Start the server using the custom bunAdapter
bunAdapter(app).listen(3001, () => {
  console.log("Server running on http://localhost:3001");
});
```

---

### **Step-by-Step Setup**

#### **Step 1: Install Bun**

Bun is required as the runtime. Install it if not already present:

- **macOS/Linux**:

  ```bash
  curl -fsSL https://bun.sh/install | bash
  ```

- **Windows** (via WSL or scoop):

  ```bash
  scoop install bun
  ```

- Verify:

  ```bash
  bun --version
  ```

#### **Step 2: Set Up Project Structure**

Create a project directory with a custom `src` folder:

```bash
mkdir tez-bun-api
cd tez-bun-api
mkdir src
```

#### **Step 3: Initialize the Project**

Initialize with Bun’s package manager:

```bash
bun init
```

- This creates `package.json` and `tsconfig.json`. Set the entry point to `index.ts` when prompted.

#### **Step 4: Prepare TezX Module**

Since imports come from `./src/index`, you need to provide or mock the `TezX` module:

- **Option 1: Use an Existing TezX Module**

  - If `TezX` is a custom library, ensure `./src/index.ts` exports:

    ```typescript
    export { bunAdapter, loadEnv, logger, Router, TezX };
    ```

  - Copy or link the module into `src/`.

- **Option 2: Install TezX as a Dependency**

  - If `TezX` is an npm package:

    ```bash
    bun add TezX
    ```

  - Update imports to `import { bunAdapter, ... } from "TezX";`.

For this guide, I’ll assume `./src/index.ts` is a custom module you’ve implemented with `bunAdapter`.

#### **Step 5: Create the Application File**

Create `index.ts` at the project root (outside `src/` for simplicity):

```bash
touch index.ts
```

Paste the code from above into `index.ts`.

#### **Step 6: Add Environment Variables (Optional)**

If `loadEnv` reads from a `.env` file:

- Create `.env`:

  ```bash
  touch .env
  ```

- Example content:

  ```
  PORT=3001
  API_KEY=your-secret-key
  ```

- Ensure `loadEnv` in `./src/index.ts` supports this (e.g., using Bun’s `process.env` or a custom loader).

#### **Step 7: Implement bunAdapter (If Custom)**

If `bunAdapter` isn’t provided by `TezX`, here’s a minimal implementation for `./src/index.ts`:

```typescript
import { TezX } from "TezX"; // Adjust based on actual source

export const bunAdapter = (app: TezX) => ({
  listen: (port: number, callback?: () => void) => {
    Bun.serve({
      fetch: app.fetch, // TezX fetch handler
      port,
    });
    callback?.();
  },
});

// Export other utilities (mocked or real)
export { loadEnv, logger, Router, TezX } from "TezX"; // Adjust as needed
```

This adapts `TezX` to Bun’s server API.

#### **Step 8: Run the Server**

Execute the application:

```bash
bun run index.ts
```

- Or add to `package.json`:

  ```json
  "scripts": {
    "start": "bun run index.ts"
  }
  ```

  Then:

  ```bash
  bun start
  ```

Output: `Server running on http://localhost:3001`.

---

### **Sample Requests**

| Method | Path             | Response                                        |
| ------ | ---------------- | ----------------------------------------------- |
| GET    | `/products/test` | `"from outside"`                                |
| GET    | `/products`      | `{}`                                            |
| GET    | `/products/123`  | `{"message": "Product ID: 123"}`                |
| POST   | `/products`      | `{"message": "Product Created", "data": {...}}` |
| PUT    | `/products/123`  | `{"message": "Product ID 123 Updated"}`         |
| DELETE | `/products/123`  | `{"message": "Product ID 123 Deleted"}`         |

- Test with:

  ```bash
  curl http://localhost:3001/products/test
  ```

---

### **Professional Enhancements**

1. **Error Handling**:

   ```typescript
   app.use(async (ctx, next) => {
     try {
       return await next();
     } catch (error) {
       return ctx.json({ error: "Server Error" }, 500);
     }
   });
   ```

2. **Type Safety**:

   ```typescript
   interface Product {
     id: string;
     name: string;
   }

   productRouter.post("/products", async (ctx) => {
     const productData: Product = await ctx.req.json();
     return ctx.json({ message: "Product Created", data: productData });
   });
   ```

3. **Dynamic Port**:

   ```typescript
   const port = env.PORT ? parseInt(env.PORT, 10) : 3001;
   bunAdapter(app).listen(port, () => {
     console.log(`Server running on http://localhost:${port}`);
   });
   ```

4. **Enhanced Logging**:

   ```typescript
   group.use(async (ctx, next) => {
     const start = Date.now();
     console.log(`[${ctx.req.method}] ${ctx.req.pathname}`);
     const res = await next();
     console.log(`Completed in ${Date.now() - start}ms`);
     return res;
   });
   ```

---

### **Troubleshooting**

- **Import Errors**: Verify `./src/index.ts` exports all required symbols.
- **bunAdapter Not Found**: Ensure it’s defined in `./src/index.ts` or adjust to use `Bun.serve` directly.
- **Port in Use**: Change `3001` to another port if needed.

---

This setup leverages `bunAdapter` for a custom Bun integration with `TezX`. Let me know if you need help implementing `./src/index.ts` or further refinements!
