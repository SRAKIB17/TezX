Below is a professional, step-by-step guide to setting up your `TezX` application with **Deno**, using the provided code that includes `denoAdapter`. I’ll assume `./src/index` is a custom module exporting `TezX` utilities, including `denoAdapter`. The `/products/test` route is retained as per your input, and I’ll provide a polished setup process tailored for Deno.

---

### **TezX Configuration with Deno (Using denoAdapter)**

This guide demonstrates how to create a RESTful API for managing products using `TezX` with Deno, leveraging a custom `denoAdapter` for server setup.

---

#### **Final Code**

```typescript
// Import TezX modules from a custom source
import {
  denoAdapter,
  loadEnv,
  logger,
  nodeAdapter,
  Router,
  TezX,
} from "./src/index.ts";

// Load environment variables (e.g., from a .env file)
const env = loadEnv();

// Initialize the TezX application with configuration
const server = new TezX({
  logger: logger, // Built-in logger for request/response logging
  env: env, // Environment variables for configuration
  allowDuplicateMw: true, // Allows duplicate middleware registration
});

// **Product Routes**

// Define a standalone route outside the router
server.get("/products/test", (ctx) => {
  return ctx.text("from outside"); // Simple text response
});

// Initialize a new Router instance for product-related routes
const productRouter = new Router({});

// Group product routes with shared middleware
productRouter.group("", (group) => {
  // Middleware applied to all routes in this group
  group.use((ctx, next) => {
    console.log("inside router"); // Log for debugging
    return next(); // Proceed to next middleware/handler
  });

  // GET /products - Returns an empty JSON object
  group.get("/products", async (ctx) => {
    return ctx.json({});
  });
});

// GET /products/:id - Fetch product by ID
productRouter.get("/products/:id", async (ctx) => {
  return ctx.json({ message: `Product ID: ${ctx.req.params.id}` });
});

// POST /products - Create a new product
productRouter.post("/products", async (ctx) => {
  const productData = await ctx.req.json(); // Parse request body
  return ctx.json({ message: "Product Created", data: productData });
});

// PUT /products/:id - Update a product by ID
productRouter.put("/products/:id", async (ctx) => {
  return ctx.json({ message: `Product ID ${ctx.req.params.id} Updated` });
});

// DELETE /products/:id - Delete a product by ID
productRouter.delete("/products/:id", async (ctx) => {
  return ctx.json({ message: `Product ID ${ctx.req.params.id} Deleted` });
});

// Mount the productRouter at the root path "/"
server.use("/", productRouter);

// Start the server using the custom denoAdapter
denoAdapter(server).listen(3001, () => {
  console.log("Server running on http://localhost:3001");
});
```

---

### **Step-by-Step Setup**

#### **Step 1: Install Deno**

Deno is a secure runtime for JavaScript and TypeScript. Install it:

- **macOS/Linux** (via shell):

  ```bash
  curl -fsSL https://deno.land/x/install/install.sh | sh
  ```

- **Windows** (via PowerShell):

  ```powershell
  iwr https://deno.land/x/install/install.ps1 -useb | iex
  ```

- Verify:

  ```bash
  deno --version
  ```

#### **Step 2: Set Up Project Structure**

Create a project directory with a `src` folder:

```bash
mkdir tez-deno-api
cd tez-deno-api
mkdir src
```

#### **Step 3: Create the Application File**

Create `index.ts` at the project root:

```bash
touch index.ts
```

Paste the code from above into `index.ts`.

#### **Step 4: Prepare TezX Module**

The imports reference `./src/index.ts`, so you need to provide this module:

- **Option 1: Custom TezX Module**

  - Create `./src/index.ts`:

    ```bash
    touch src/index.ts
    ```

  - Add exports (example implementation):

    ```typescript
    export {
      loadEnv,
      logger,
      Router,
      TezX,
    } from "https://deno.land/x/tezx/mod.ts"; // Hypothetical Deno URL
    export const denoAdapter = (app: TezX) => ({
      listen: (port: number, callback?: () => void) => {
        Deno.serve({ port }, app.fetch); // Use Deno.serve with TezX fetch
        callback?.();
      },
    });
    export const nodeAdapter = () => {
      throw new Error("nodeAdapter not supported in Deno");
    };
    ```

  - Adjust the import URL if `TezX` is available elsewhere.

- **Option 2: External Dependency**

  - If `TezX` is a published Deno module, import directly:

    ```typescript
    import {
      denoAdapter,
      loadEnv,
      logger,
      nodeAdapter,
      Router,
      TezX,
    } from "https://deno.land/x/tezx/mod.ts";
    ```

  - For this guide, I’ll assume `./src/index.ts` is custom.

#### **Step 5: Add Environment Variables (Optional)**

If `loadEnv` uses a `.env` file:

- Create `.env`:

  ```bash
  touch .env
  ```

- Example:

  ```
  PORT=3001
  API_KEY=your-secret-key
  ```

- Implement `loadEnv` in `./src/index.ts` (e.g., using `Deno.env` or a file reader):

  ```typescript
  export function loadEnv() {
    return Deno.env.toObject();
  }
  ```

#### **Step 6: Implement denoAdapter (If Custom)**

If `denoAdapter` isn’t provided, here’s a minimal version for `./src/index.ts`:

```typescript
import { TezX } from "https://deno.land/x/tezx/mod.ts"; // Adjust source

export const denoAdapter = (app: TezX) => ({
  listen: (port: number, callback?: () => void) => {
    Deno.serve({ port }, app.fetch); // Deno's built-in server
    callback?.();
  },
});
```

#### **Step 7: Run the Server**

Run the application with Deno, granting necessary permissions:

```bash
deno run --allow-net --allow-env index.ts
```

- `--allow-net`: Permits network access for the server.
- `--allow-env`: Allows reading environment variables.

Output: `Server running on http://localhost:3001`.

---

### **Sample Requests**

| Method | Path             | Response                                        |
| ------ | ---------------- | ----------------------------------------------- |
| GET    | `/products/test` | `"from outside"`                                |
| GET    | `/products`      | `{}`                                            |
| GET    | `/products/123`  | `{"message": "Product ID: 123"}`                |
| POST   | `/products`      | `{"message": "Product Created", "data": {...}}` |
| PUT    | `/products/123`  | `{"message": "Product ID 123 Updated"}`         |
| DELETE | `/products/123`  | `{"message": "Product ID 123 Deleted"}`         |

- Test with:

  ```bash
  curl http://localhost:3001/products/test
  ```

---

### **Professional Enhancements**

1. **Error Handling**:

   ```typescript
   server.use(async (ctx, next) => {
     try {
       return await next();
     } catch (error) {
       return ctx.json({ error: "Server Error" }, 500);
     }
   });
   ```

2. **Type Safety**:

   ```typescript
   interface Product {
     id: string;
     name: string;
   }

   productRouter.post("/products", async (ctx) => {
     const productData: Product = await ctx.req.json();
     return ctx.json({ message: "Product Created", data: productData });
   });
   ```

3. **Dynamic Port**:

   ```typescript
   const port = env.PORT ? parseInt(env.PORT, 10) : 3001;
   denoAdapter(server).listen(port, () => {
     console.log(`Server running on http://localhost:${port}`);
   });
   ```

4. **Enhanced Logging**:

   ```typescript
   group.use(async (ctx, next) => {
     const start = Date.now();
     console.log(`[${ctx.req.method}] ${ctx.req.pathname}`);
     const res = await next();
     console.log(`Completed in ${Date.now() - start}ms`);
     return res;
   });
   ```

---

### **Troubleshooting**

- **Import Errors**: Ensure `./src/index.ts` exports all symbols correctly.
- **denoAdapter Not Found**: Verify its implementation in `./src/index.ts`.
- **Permission Denied**: Add `--allow-net` and `--allow-env` flags to `deno run`.

---

This setup uses `denoAdapter` for a custom Deno integration with `TezX`. Let me know if you need assistance with `./src/index.ts` or further customization!
