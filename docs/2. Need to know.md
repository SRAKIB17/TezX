# 📖 TezX Router — Need to Know

The **TezX Router** is designed for **high-performance, Radix-based routing**.
While it gives you expressive route definitions, there are some **important compatibility details** developers must understand before using it in production.

---

## 🔁 Method Overwrites

* **Same path + same method → overwrite**

  ```ts
  app.get("/user", (ctx) => ctx.text("First"));
  app.get("/user", (ctx) => ctx.text("Second")); // ✅ Overwrites previous
  ```

  * The **last registered handler wins**.
  * Useful if you want to override routes conditionally.

* **Same path + different methods → both coexist**

  ```ts
  app.get("/user", (ctx) => ctx.text("GET user"));
  app.post("/user", (ctx) => ctx.text("POST user"));
  ```

  * No conflicts between HTTP methods.

---

## 🧩 Optional Segments

⚠️ **Important:** The underlying `RadixRouter` does **not support optional segments (`?`) natively.**

### ✅ How TezX Handles It

TezX automatically **expands optional params** into all possible permutations:

```ts
// Route definition
/test/:o1?/:o2?
```

Expands into:

1. `/test`
2. `/test/:o1`
3. `/test/:o2`
4. `/test/:o1/:o2`

---

### 🔒 Expansion Limits

* Expansion is **always enabled internally** (cannot be disabled).
* **Default maxExpansion = 6**

  * 6 optional params → `2^6 = 64` routes.
  * 10 optional params → `2^10 = 1024` routes (!).

👉 Too many optional params can cause **combinatorial explosion** in route registration.

---

### ⚡ Performance Notes

* Each expanded permutation = an actual registered route.
* Large expansions increase:

  * Memory footprint
  * Startup time
  * Matching overhead

**Best Practice:** Avoid more than **3–4 optional params per route**.
If you need more → break into multiple routes.

---

## 🚫 Middleware Limitation

* **Middleware does not support optional params.**
* If optional params are defined in middleware routes → they are automatically treated as **required**.

```ts
app.use("/a/:b/:c?",...)
// internally treated as (required)
app.use("/a/:b/:c",...)
```

---

## 🛠 Correct Usage Examples

✅ **Good**

```ts
// Explicit permutations are safe
app.get("/a/b/c", handler);
app.get("/a/b/:test", handler);

// Optional expansion handled internally
app.get("/test/:o1?/test/:o2?", handler);
```

❌ **Bad**

```ts
// Consecutive optional params confuse RadixRouter
app.get("/:a/:b?", handler);  // 🚫 Will break
```

👉 Fix by inserting a fixed segment in between:

```ts
app.get("/:a/extra/:b?", handler); // ✅ Works
```

---

## ⚙️ Config Options (`TezXConfig`)

```ts
export type TezXConfig = {
  /**
   * Hook to transform/normalize pathnames before routing.
   * Example: remove trailing slash, lowercase, etc.
   */
  onPathResolve?: (pathname: string) => string;

  /**
   * Debug logs for routing & middleware.
   */
  debugMode?: boolean;
} & RouterConfig;

export type RouterConfig = {
  routeRegistry?: RouteRegistry;

  optionalSegments?: {
    expand?: boolean;      // Always true internally
    maxExpansion?: number; // Default: 6
  };

  env?: Record<string, string | number>;

  basePath?: string; // Prefix all routes (e.g. "/api/v1")
};
```

---

## 📌 Quick Compatibility Checklist

* ✅ Same method + path → overwritten (last wins).
* ✅ Same path + different methods → coexist.
* ✅ Optional segments auto-expanded (max `2^n` routes).
* ⚠️ Expansion limit default: 6 (64 routes).
* ⚠️ Too many optionals → performance hit.
* ❌ Middleware does not support optionals (converted to required).
* ✅ Use `onPathResolve` for normalization (lowercase, no trailing slash).

---
