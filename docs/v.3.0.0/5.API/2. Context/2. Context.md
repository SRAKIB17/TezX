
# üìò TezX `Context` ‚Äî Developer Guide

The `Context` object in TezX encapsulates the HTTP request and response, providing convenient methods to access request data, manipulate headers, send various types of responses, and manage files ‚Äî all within the lifecycle of a single HTTP transaction.

---

## üîÅ Request Handling

### `ctx.req` ‚Äî The Wrapped Request Object

Provides high-level access to incoming HTTP request data:

```ts
ctx.req.query;       // Parsed query parameters as an object
await ctx.req.json();      // Parse JSON body
await ctx.req.formData();  // Parse form data (including multipart/form-data)
ctx.req.header(name);      // Get header by name (case-insensitive)
ctx.req.method;       // HTTP method (GET, POST, etc.)
ctx.req.url;          // Full request URL string
ctx.req.params;       // Route parameters (e.g., from /user/:id)
```

---

## üè∑Ô∏è Header Utilities

### Get All Headers

```ts
const headers = ctx.header();
console.log(headers);
// Output: { 'content-type': 'application/json', ... }
```

### Get Specific Header (Case-Insensitive)

```ts
const contentType = ctx.header("content-type");
console.log(contentType); // e.g. 'application/json'
```

### Set or Append Response Headers

```ts
ctx.setHeader("x-powered-by", "TezX");
ctx.setHeader("x-custom", "value", { append: true });
```

* The `append` option appends the header value instead of overwriting.

---

## üì° Response Helpers

### Set HTTP Status Code

```ts
ctx.status(404); // Chainable
```

### Send Response with Automatic Content-Type Detection

```ts
ctx.send({ message: "OK" });        // Sends JSON by default
ctx.send("<h1>Hello</h1>");         // Sends HTML content
ctx.send("Plain text response");    // Sends plain text
```

### Send JSON Response

```ts
ctx.json({ success: true });
```

### Send Plain Text Response

```ts
ctx.text("Hello World");
```

### Send HTML Response

```ts
ctx.html("<h1>Welcome</h1>");
```

Or using tagged template literal syntax:

```ts
ctx.html`<h1>Hello, ${username}</h1>`;
```

### Send XML Response

```ts
ctx.xml(`<user><name>John</name></user>`);
```

### Redirect Client

```ts
ctx.redirect("/login");       // Defaults to HTTP 302 Found
ctx.redirect("/admin", 301);  // Permanent redirect
```

---

## üìÅ File Streaming & Downloads

### Send File (Streaming)

```ts
await ctx.sendFile("/public/image.png");
```

With additional headers or custom filename:

```ts
await ctx.sendFile("/docs/manual.pdf", {
  filename: "UserManual.pdf",
  headers: { "X-Sent-By": "TezX" },
});
```

### Force File Download with Custom Filename

```ts
await ctx.download("/files/invoice.pdf", "Invoice-2024.pdf");
```

---

## üì¶ Complete Example

```ts
import { TezX } from "tezx";

const app = new TezX();

app.get("/", (ctx) => ctx.text("Welcome to TezX"));

app.post("/data", async (ctx) => {
  const body = await ctx.req.json();
  return ctx.json({ received: body });
});

app.get("/user/:id", (ctx) => {
  const userId = ctx.req.params.id;
  return ctx.json({ userId });
});

app.get("/download", async (ctx) => {
  return await ctx.download("./files/sample.pdf", "sample.pdf");
});

app.get("/html", (ctx) => {
  return ctx.html`<h1>Hello ${ctx.env.username || "Guest"}</h1>`;
});

export default app;
```

---

## üß™ Handling Form Data (Multipart)

```ts
app.post("/upload", async (ctx) => {
  const formData = await ctx.req.formData();
  const file = formData.get("image");
  const username = formData.get("username");
  return ctx.json({ uploadedBy: username });
});
```

**HTML form example for testing:**

```html
<form method="POST" action="/upload" enctype="multipart/form-data">
  <input type="text" name="username" placeholder="Your Name" />
  <input type="file" name="image" />
  <button type="submit">Upload</button>
</form>
```

---

## üß† Pro Tip: Chainable Methods

Most context methods are chainable for concise response building:

```ts
ctx.status(201)
   .setHeader("x-token", "abc123")
   .json({ message: "Resource created" });
```

---

# Summary

| Feature          | Description                                 | Usage Example                                  |
| ---------------- | ------------------------------------------- | ---------------------------------------------- |
| Request Query    | Access parsed query parameters              | `ctx.req.query`                                |
| Request Body     | Parse JSON or form data                     | `await ctx.req.json()`                         |
| Headers          | Get/set response headers                    | `ctx.header()`, `ctx.setHeader()`              |
| Response Types   | Send JSON, text, HTML, XML, redirects       | `ctx.json()`, `ctx.text()`, `ctx.redirect()`   |
| File Streaming   | Send or download files with custom headers  | `await ctx.sendFile()`, `await ctx.download()` |
| Middleware Ready | Context flows through middleware with async | `await next()` in handlers                     |
