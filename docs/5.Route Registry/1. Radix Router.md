# 📦 RadixRouter

`RadixRouter` is a **high-performance HTTP router** using a radix tree for **fast, memory-efficient route matching**. It supports static, dynamic, optional, and wildcard routes, with middleware stacking and router composition for modular applications.

```mermaid
sequenceDiagram
    autonumber
    participant Client as 🧑‍💻 HTTP Client
    participant Router as 🧭 RadixRouter
    Note over Router: Match priority → **Static → Dynamic → Optional → Wildcard**

    Client->>Router: Incoming Request (method + path)

    alt Static Segment Match
        Router-->>Client: Return Handlers
    else Dynamic Segment Match
        Router-->>Client: Return Handlers + Params
    else Optional Segment Match
        Router-->>Client: Return Handlers (Param or null)
    else Wildcard Segment Match
        Router-->>Client: Return Handlers (remaining path)
    else No Match
        Router-->>Client: 404 Not Found
    end
```

---

## 🔍 Key Features

* **Static Routes:** `/users`
* **Dynamic Parameters:** `/users/:id`
* **Optional Parameters:** `/users/:id?`
* **Wildcards:** `/files/*path`
* **Middleware Stacking:** Global & route-specific
* **Router Composition:** Merge sub-routers for maintainability

---

## 📄 Usage

### Initialize Router

```ts
import { RadixRouter } from "tezx/registry";

const router = new RadixRouter();
```

---

### Add Routes

```ts
router.addRoute("GET", "/hello", [(ctx) => ctx.text("Hello World")]);

router.addRoute("GET", "/user/:id?", [
  (ctx) => ctx.text(`User ID: ${ctx.params.id ?? "Guest"}`),
]);

router.addRoute("GET", "/files/*path", [serveFileHandler]);
```

*Supports static, dynamic (`:id`), optional (`:id?`), and wildcard (`*path`) segments.*

---

### Search Routes

```ts
const match = router.search("GET", "/user/123");
await match.handlers[0](ctx); // Executes matched handler
```

**Return Structure:**

```ts
{
  method: "GET",
  params: { id: "123" },
  middlewares: [...],
  handlers: [...],
}
```

---

## ⚡ Matching Priority

1. **Static segments** (`/users`)
2. **Dynamic segments** (`/users/:id`)
3. **Optional segments** (`/users/:id?`)
4. **Wildcard segments** (`/files/*path`)

Backtracking ensures optional segments fallback gracefully.

---

## 🧩 Internal: `parsePattern`

Segments are parsed into:

```ts
type Segment = {
  type: "static" | "dynamic" | "wildcard";
  value?: string;
  paramName?: string;
  isOptional?: boolean;
};
```

Used internally for **efficient radix tree insertion & matching**.

---

## 📊 Performance (Updated Benchmark)

```text
RadixRouter.search()
Total ops:       1,200,000
Total time:      170.72 ms
Avg per op:      142.26 ns (0.142 µs)
Throughput:      7,029,244 ops/sec
```

> Extremely fast and suitable for **high-traffic, low-latency applications**.

---

## 🛠 Types

```ts
type RouteMatchResult<T> = {
  method: HTTPMethod;
  middlewares: Middleware<T>[];
  handlers: HandlerType<T>[];
  params: Record<string, string | null | undefined>;
};

interface RouteRegistry {
  name: string;
  addRoute<T>(method: HTTPMethod, path: string, handler: HandlerType<T>): void;
  search(method: HTTPMethod, path: string): RouteMatchResult<T>;
}
```

---
