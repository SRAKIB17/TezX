# üîÅ **Response Handling in TezX**

The TezX framework provides a rich and extensible response system through the `ctx` object. This system supports typed utilities for sending structured responses, including JSON, HTML, plain text, file downloads, redirects, and more.

---

## üß© **Core Type Definitions**

```ts
/**
 * Callback to continue the middleware chain.
 */
export type NextCallback = () => Promise<void>;

/**
 * A valid return type from any route handler or middleware.
 */
export type HttpBaseResponse = Response | Promise<Response>;

/**
 * Context object passed to routes/middleware.
 * @template T - Extended application state.
 * @template Path - Typed path string.
 */
export type Ctx<T extends Record<string, any> = {}, Path extends string = any> =
  Context<T, Path> & T & Record<string, any>;

/**
 * Route callback signature.
 */
export type Callback<T = {}, Path extends string = any> =
  (ctx: Ctx<T, Path>) => HttpBaseResponse;

/**
 * TezX middleware function signature.
 */
export type Middleware<T = {}, Path extends string = any> =
  (ctx: Ctx<T, Path>, next: NextCallback) =>
    HttpBaseResponse | Promise<HttpBaseResponse | void> | NextCallback;

/**
 * Error-handling callback.
 */
export type ErrorHandler<T = {}> =
  (err: Error, ctx: Ctx<T>) => HttpBaseResponse;
```

---

## ‚úÖ **Custom Response (Native Response Object)**

For full control, return a native `Response` directly:

```ts
app.get("/data", (ctx) => {
  return new Response("Hello World", {
    status: 200,
    headers: { "Content-Type": "text/plain" },
  });
});
```

---

## üöÄ **Response Utilities on `ctx`**

### `ctx.json(body, status?, headers?)`

Sends a JSON response.

```ts
app.get("/json", (ctx) => {
  return ctx.json({ success: true }, 200);
});
```

* **Content-Type**: `application/json`
* **Returns**: `Response`

---

### `ctx.html(html, status?, headers?)`

Returns an HTML response.

```ts
app.get("/html", (ctx) => {
  return ctx.html("<h1>Welcome</h1>");
});
```

* **Content-Type**: `text/html`

---

### `ctx.text(text, status?, headers?)`

Returns plain text.

```ts
app.get("/plain", (ctx) => {
  return ctx.text("Just a plain message.");
});
```

* **Content-Type**: `text/plain`

---

### `ctx.xml(xml, status?, headers?)`

Sends XML content.

```ts
app.get("/xml", (ctx) => {
  return ctx.xml("<note><msg>Hi</msg></note>");
});
```

* **Content-Type**: `application/xml`

---

### `ctx.send(body, status?, headers?)`

Smart responder. Infers content type:

```ts
app.get("/send", (ctx) => {
  return ctx.send({ user: "admin" });
});
```

* **Content-Type** inferred from `body` type:

  * `object` ‚Üí `application/json`
  * `string` ‚Üí `text/plain`
  * `Buffer`/`Uint8Array` ‚Üí `application/octet-stream`

---

### `ctx.redirect(url, status?, headers?)`

Redirects to a target URL.

```ts
app.get("/go", (ctx) => {
  return ctx.redirect("https://example.com");
});
```

* **Default Status**: `302`
* **Header**: `Location`

---

### `ctx.download(filePath, fileName)`

Triggers a file download with a custom file name.

```ts
app.get("/download", (ctx) => {
  return ctx.download("/files/report.pdf", "Monthly-Report.pdf");
});
```

* **Header**: `Content-Disposition: attachment`

---

### `ctx.sendFile(filePath, fileName?)`

Serves a static file directly.

```ts
app.get("/image", (ctx) => {
  return ctx.sendFile("/assets/banner.jpg");
});
```

* Automatically sets `Content-Type` and streams file.
* Optional custom file name.

---

## üõ†Ô∏è Best Practices

| Use Case                | Recommended Method |
| ----------------------- | ------------------ |
| JSON API response       | `ctx.json()`       |
| HTML rendering          | `ctx.html()`       |
| Serving static assets   | `ctx.sendFile()`   |
| Secure file download    | `ctx.download()`   |
| External redirects      | `ctx.redirect()`   |
| Manual response control | Native `Response`  |

---
