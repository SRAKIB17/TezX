# TezX JWT Module ‚Äì Developer Documentation

## Overview

`tezx/jwt` is a **lightweight, dependency-free JSON Web Token (JWT) module** designed for the TezX framework. It provides **signing, verification, and expiration management** for JWTs using either:

- **Node.js crypto** (for server-side)
- **WebCrypto API** (for modern runtimes: browser, Deno, Bun)

Key Features:

- ‚úÖ Pure implementation (no external dependencies)
- ‚ö° Supports `HS256` and `HS512` algorithms
- ‚è± Flexible expiration format (`"1h"`, `"2d"`, `"30m"`, numeric seconds)
- üîí Safe Base64URL encoding/decoding (RFC 7515)
- üß© Works in **Node.js**, **Bun**, **Deno**, or TezX server environment
- üì¶ Easy to integrate as a middleware or standalone utility

---

## Installation

```bash
# if using npm/yarn
npm install tezx
# or
yarn add tezx
```

---

## Importing

```ts
import { sign, verify } from "tezx/jwt/web"; // For WebCrypto-compatible runtimes
// or
import { sign, verify } from "tezx/jwt/node"; // Node.js-compatible
```

- `sign` ‚Äì generate JWT token
- `verify` ‚Äì decode & verify JWT token

---

## Functions

### 1. `sign(payload, options)`

Generates a signed JWT token.

**Parameters**:

| Parameter           | Type                  | Description                                                                         |                                          |
| ------------------- | --------------------- | ----------------------------------------------------------------------------------- | ---------------------------------------- |
| `payload`           | `Record<string, any>` | The data or claims to include in the token                                          |                                          |
| `options`           | `Object`              | Optional configuration                                                              |                                          |
| `options.secret`    | `string`              | Secret key to sign the token (default: `process.env.JWT_SECRET` or `"tezx_secret"`) |                                          |
| `options.algorithm` | `"HS256"              | "HS512"`                                                                            | Hash algorithm to use (default: `HS256`) |
| `options.expiresIn` | `string \| number`    | Token expiration, e.g., `"2h"`, `"7d"`, `3600` (seconds)                            |                                          |

**Returns**: `string` ‚Äì signed JWT token in format `header.payload.signature`

**Example**:

```ts
import { sign } from "tezx/jwt/node";

const token = sign(
  { userId: 101, role: "trainer" },
  { secret: "5435345", algorithm: "HS512", expiresIn: "2h" },
);

console.log("JWT:", token);
```

> ‚ö° **WebCrypto version** returns a `Promise<string>`.

---

### 2. `verify(token, secret)`

Verifies a JWT token and returns the payload if valid.

**Parameters**:

| Parameter | Type     | Description                                                                              |
| --------- | -------- | ---------------------------------------------------------------------------------------- |
| `token`   | `string` | The JWT string to verify                                                                 |
| `secret`  | `string` | Secret key used to sign the token (default: `process.env.JWT_SECRET` or `"tezx_secret"`) |

**Returns**:

- `Record<string, any>` ‚Äì decoded payload if token is valid and not expired
- `null` ‚Äì if invalid or expired

**Example**:

```ts
import { verify } from "tezx/jwt/node";

const decoded = verify(token, "5435345");

if (decoded) {
  console.log("User ID:", decoded.userId);
} else {
  console.log("Invalid or expired token");
}
```

> ‚ö° **WebCrypto version** returns `Promise<Record<string, any> | null>`.

---

## Base64URL Encoding (internal)

The module automatically encodes and decodes JWT parts using **Base64URL**:

```ts
import { sign } from "tezx/jwt/node";

const token = sign({ userId: 1 });
// Base64URL ensures URL-safe JWT with no padding
```

> Do **not manually modify** JWT parts unless you follow RFC 7515 rules.

---

## Expiration Handling

- Human-readable string formats:
  - `"30m"` ‚Üí 30 minutes
  - `"2h"` ‚Üí 2 hours
  - `"1d"` ‚Üí 1 day

- Numeric seconds: `3600` ‚Üí 1 hour
- Default expiration is **1 day** if not provided

```ts
const token = sign({ userId: 1 }, { expiresIn: "2h" });
```

---

## TezX Middleware Example

You can create a middleware for protected routes:

```ts
import { verify } from "tezx/jwt/node";

export function jwtMiddleware({ secret }) {
  return async (ctx, next) => {
    const auth = ctx.headers.get("authorization") || "";
    const token = auth.startsWith("Bearer ") ? auth.slice(7) : null;

    if (!token) return ctx.status(401).json({ error: "Missing token" });

    const payload = verify(token, secret);
    if (!payload)
      return ctx.status(401).json({ error: "Invalid or expired token" });

    ctx.user = payload; // inject payload into context
    await next();
  };
}
```

**Usage**:

```ts
import { jwtMiddleware } from "./middleware";

app.use(jwtMiddleware({ secret: "5435345" }));

app.get("/dashboard", async (ctx) => {
  console.log(ctx.user); // access decoded JWT
  return ctx.json({ message: "Welcome to dashboard" });
});
```

---
