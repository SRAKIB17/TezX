# **Router with Merging**

---

## **Overview of Routing**

- **Parent Router**: The existing routing structure before merging.
- **New Sub-Router**: A new routing structure to be merged into the parent router.
- **Final Router**: The resulting structure after merging.

---

## **Example: Before Merge**

Here’s an example of a parent router before any merging occurs:

```bash
Parent Router:
├── test (Router)
│   ├── GET -> { handler1 }
│   ├── children:
│       ├── 1 (Router)
│           ├── GET -> { handler2 }
```

- `/test` (root node) has a `GET` handler (`handler1`).
- `/test/1` (child node) has its own `GET` handler (`handler2`).

---

## **Merging a New Router**

A new sub-router can be merged into the parent router. Here’s an example of a new router to merge:

```bash
New Sub-Router:
├── products
│   ├── children:
│       ├── 2 (Router)
│           ├── GET -> { handler3 }
```

- `/products/2` has a `GET` handler (`handler3`).

---

## **After Merging**

When the new sub-router is merged into the parent router, the resulting structure depends on the merge logic and configuration (e.g., `overwriteMethod`). Here’s an example of the final router:

```bash
Final Router:
├── test (Router)
│   ├── GET -> { handler1 }
│   ├── children:
│       ├── 1 (Router)
│           ├── GET -> { handler2 }
├── products (Router)
│   ├── children:
│       ├── 2 (Router)
│           ├── GET -> { handler3 }
```

- The `/test` branch remains unchanged.
- The `/products` branch is added as a new root-level node with its child `/products/2`.

**Note**: If the new sub-router had overlapping paths (e.g., `/test` instead of `/products`), the behavior would depend on the `overwriteMethod` setting (see below).

---

## **Configuration: `overwriteMethod`**

The `overwriteMethod` option controls how `TezX` handles overlapping routes—i.e., when a new handler is added for the same path and HTTP method as an existing handler.

### **Definition**

```typescript
/**
 * `overwriteMethod` controls whether existing route handlers
 * should be overwritten when a new handler for the same
 * HTTP method and path is added.
 *
 * - When `true`: The new handler replaces the existing one.
 * - When `false`: Prevents overwriting, ensuring that the
 *   first registered handler remains active.
 *
 * @default true
 */
overwriteMethod?: boolean;
```

### **Usage**

```typescript
const app = new TezX({
  logger: logger,
  allowDuplicateMw: true, // Allows duplicate middleware, if applicable
  overwriteMethod: false, // Prevents overwriting existing handlers
});
```

### **Behavior**

- **`overwriteMethod: true` (default)**:
  - If a new `GET` handler is added to `/test` and a `GET` handler already exists, the new handler overwrites the old one.
  - Example:

```bash
Before:
├── test (Router)
│   ├── GET -> { handler1 }

After adding new GET handler:
├── test (Router)
│   ├── GET -> { newHandler }
```

- **`overwriteMethod: false`**:
  - The existing handler is preserved, and the new handler is ignored.
  - Example:

```bash
Before:
├── test (Router)
│   ├── GET -> { handler1 }

After attempting to add new GET handler:
├── test (Router)
│   ├── GET -> { handler1 } (unchanged)
```

---

## **Key Features**

1. **Efficient Merging**: Sub-routers can be merged into the parent router without disrupting unrelated routes.
2. **Overlapping Control**: Use `overwriteMethod` to decide how overlapping routes are handled.
3. **Nested Routes**: Child nodes allow for deep nesting (e.g., `/test/1`, `/products/2`).

---

## **Best Practices**

- Set `overwriteMethod: false` in production environments to prevent accidental overwriting of critical handlers.
- Use descriptive handler names or logging to debug route conflicts.
- Test merged router thoroughly to ensure the final structure matches your expectations.

---
