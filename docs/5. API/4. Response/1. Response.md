# **Response**

---

## **Overview**

The `Response` methods are part of a web framework's context (`ctx`) object, enabling developers to send HTTP responses in various formats. The `Callback` type supports flexible return values, including `string`, `Record<string, any>`, `Response`, and now supports setting `ctx.body` to any value, which is automatically converted to a `Response`. This documentation details each method, the new `ctx.body` feature, their parameters, return types, and usage examples.

### **Type Definitions**

```typescript
export type NextCallback = () => Promise<any>;

export type ctx<T extends Record<string, any> = {}> = Context<T> &
  T & {
    body?: any; // New property to hold response body
  };

export type Callback<T extends Record<string, any> = {}> = (
  ctx: ctx<T>,
) => Promise<Response | void> | Response | string | Record<string, any> | void;
```

- **`NextCallback`**: A function returning a `Promise` for middleware chaining.
- **`ctx<T>`**: The context object, extensible with custom properties via `T`, now including an optional `body` property of type `any`.
- **`Callback<T>`**: A handler function that can return:
  - `Promise<Response | void>`: Asynchronous response or no response.
  - `Response`: A native HTTP response object.
  - `string`: Plain text response.
  - `Record<string, any>`: JSON-serializable object.
  - `void`: No response (e.g., for middleware). If `ctx.body` is set, it is automatically wrapped as a `Response`.

---

## **Custom Response**

For fine-grained control, return a native `Response` object directly:

```typescript
app.get("/data", async (ctx: ctx) => {
  return new Response("Hello World", {
    status: 200,
    headers: { "Content-Type": "text/plain" },
  });
});
```

---

## **🔧 Using `ctx.body`**

### **📖 Description**

`ctx.body` allows you to assign a response value inside a handler without explicitly returning a `Response`.  
If a handler does **not** return a value, the framework automatically constructs a `Response` using `ctx.body`, with intelligent content type and status inference.

---

### **🧠 Priority Logic:**

1. If the handler **returns** a value, it takes precedence.
2. If the handler returns `undefined`, then `ctx.body` (if set) will be used to generate the response.

---

### **⚙️ Behavior**

- **🧩 Type Inference:**

  - `string` → `Content-Type: text/plain`
  - `object` (e.g. `{}`) → `Content-Type: application/json`
  - Other types → Converts to string using `.toString()` (fallback to `text/plain`)

- **✅ Default Status**: `200 OK` (can be overridden using `ctx.status`)

- **📬 Custom Headers**: Set via `ctx.set("Header-Name", "value")` or `ctx.header()` method if defined.

---

### **📌 Usage Examples**

```ts
// Respond with plain text
app.get("/text", (ctx) => {
  ctx.body = "Hello from ctx.body!";
  // Responds with text/plain and status 200
  return;
});

// Respond with JSON
app.get("/json", (ctx) => {
  ctx.body = { message: "Hello", status: "ok" };
  // Responds with application/json and status 200
  return;
});

// Example with custom status and headers
app.get("/custom", (ctx) => {
  ctx.status = 201;
  ctx.set("X-Custom-Header", "Tezx");
  ctx.body = { created: true };
  return;
});
```

---

## **Response Methods**

### **`json`**

#### **Description**

Serializes and sends a JSON response.

#### **Parameters**

- `body: any` – Data to serialize as JSON.
- `status?: number` (Optional) – HTTP status code (default: `200`).
- `headers?: ResponseHeaders` (Optional) – Custom response headers.

#### **Returns**

`Response` with `Content-Type: application/json`.

#### **Usage**

```typescript
app.get("/json", (ctx: ctx) => {
  return ctx.json({ message: "Success" }, 200);
});
```

#### **With `ctx.body`**

```typescript
app.get("/json", (ctx: ctx) => {
  ctx.body = { message: "Success" };
  return;
});
```

---

### **`html`**

#### **Description**

Sends an HTML response.

#### **Parameters**

- `data: string` – HTML content.
- `status?: number` (Optional) – HTTP status code (default: `200`).
- `headers?: ResponseHeaders` (Optional) – Custom response headers.

#### **Returns**

`Response` with `Content-Type: text/html`.

#### **Usage**

```typescript
app.get("/html", (ctx: ctx) => {
  return ctx.html("<h1>Hello</h1>", 200);
});
```

#### **With `ctx.body`**

```typescript
app.get("/html", (ctx: ctx) => {
  ctx.header("content-type", "text/html");
  ctx.body = "<h1>Hello</h1>"; // Served as text/plain unless ctx.html() is used
  return;
});
```

---

### **`text`**

#### **Description**

Sends a plain text response.

#### **Parameters**

- `data: string` – Text content.
- `status?: number` (Optional) – HTTP status code (default: `200`).
- `headers?: ResponseHeaders` (Optional) – Custom response headers.

#### **Returns**

`Response` with `Content-Type: text/plain`.

#### **Usage**

```typescript
app.get("/text", (ctx: ctx) => {
  return ctx.text("Hello, World!", 200);
});
```

#### **With `ctx.body`**

```typescript
app.get("/text", (ctx: ctx) => {
  ctx.body = "Hello, World!";
  return;
});
```

---

### **`xml`**

#### **Description**

Sends an XML response.

#### **Parameters**

- `data: string` – XML content.
- `status?: number` (Optional) – HTTP status code (default: `200`).
- `headers?: ResponseHeaders` (Optional) – Custom response headers.

#### **Returns**

`Response` with `Content-Type: application/xml`.

#### **Usage**

```typescript
app.get("/xml", (ctx: ctx) => {
  return ctx.xml("<note><msg>Hello</msg></note>", 200);
});
```

#### **With `ctx.body`**

```typescript
app.get("/xml", (ctx: ctx) => {
  ctx.body = "<note><msg>Hello</msg></note>"; // Served as text/plain unless ctx.xml() is used
  return;
});
```

---

### **`send`**

#### **Description**

Sends a response with automatic content-type inference.

#### **Parameters**

- `body: any` – Response body (e.g., `string`, `object`).
- `status?: number` (Optional) – HTTP status code (default: `200`).
- `headers?: ResponseHeaders` (Optional) – Custom response headers.

#### **Returns**

`Response` with inferred `Content-Type`.

#### **Usage**

```typescript
app.get("/send", (ctx: ctx) => {
  return ctx.send("Custom Content", 200);
});
```

#### **With `ctx.body`**

```typescript
app.get("/send", (ctx: ctx) => {
  ctx.body = "Custom Content";
  return;
});
```

---

### **`redirect`**

#### **Description**

Redirects the client to a specified URL.

#### **Parameters**

- `url: string` – Target URL.
- `status?: number` (Optional) – HTTP status code (default: `302`).
- `headers?: ResponseHeaders` (Optional) – Custom response headers.

#### **Returns**

`Response` with `Location` header.

#### **Usage**

```typescript
app.get("/redirect", (ctx: ctx) => {
  return ctx.redirect("https://example.com");
});
```

---

### **`download`**

#### **Description**

Triggers a file download.

#### **Parameters**

- `filePath: string` – Path to the file.
- `fileName: string` – Name for the downloaded file.

#### **Returns**

`Promise<Response>` with `Content-Disposition: attachment`.

#### **Usage**

```typescript
app.get("/download", async (ctx: ctx) => {
  return ctx.download("/path/to/file.pdf", "document.pdf");
});
```

---

### **`sendFile`**

#### **Description**

Serves a static file.

#### **Parameters**

- `filePath: string` – Path to the file.
- `fileName?: string` (Optional) – Name for the file in the response.

#### **Returns**

`Promise<Response>` with file stream.

#### **Usage**

```typescript
app.get("/file", async (ctx: ctx) => {
  return ctx.sendFile("/path/to/image.jpg");
});
```

---

## **Key Features**

- **Flexible Returns**: The `Callback` supports:
  - `string`: Sent as `text/plain`.
  - `Record<string, any>`: Sent as `application/json`.
  - `Response`: Custom response.
  - `Promise`: Async handling.
  - `void`: No explicit return; uses `ctx.body` if set.
- **`ctx.body`**: Automatically wrapped as a `Response` with inferred content-type if no explicit return is provided.
- **Type Safety**: Extend `ctx<T>` for custom properties (e.g., `ctx<{ userId: string }>`).
- **Cross-Runtime**: Compatible with Node.js, Bun, and Deno.

---

## **Examples**

### **Using `ctx.body` with String**

```typescript
app.get("/greet", (ctx: ctx) => {
  ctx.body = "Hello, World!";
  return;
});
```

### **Using `ctx.body` with Object**

```typescript
app.get("/user", (ctx: ctx) => {
  ctx.body = { id: 1, name: "Alice" };
  return;
});
```

### **Direct Returns**

```typescript
app.get("/direct", (ctx: ctx) => {
  return "Direct Hello"; // text/plain
});

app.get("/direct-obj", (ctx: ctx) => {
  return { data: "Direct Object" }; // application/json
});
```

### **Mixed Usage**

```typescript
app.get("/mixed", (ctx: ctx) => {
  if (someCondition) {
    return ctx.json({ error: "Not found" }, 404);
  }
  ctx.body = "All good";
  return;
});
```

---

## **Best Practices**

- **Use `ctx.body`**: For simple responses without explicit formatting.
- **Explicit Methods**: Use `ctx.json()`, `ctx.html()`, etc., for specific content-types.
- **Status Codes**: Set explicitly when needed (e.g., `ctx.status = 201` with `ctx.body`).
- **Async Safety**: `await` file methods like `download` and `sendFile`.
- **Type Extensions**: Use `ctx<T>` for type-safe custom properties.

---
